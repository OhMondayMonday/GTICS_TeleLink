<!doctype html>
<html lang="es">
    <!-- Mirrored from themesdesign.in/nazox/layouts/calendar.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 30 Aug 2024 19:31:16 GMT -->
    <head th:replace="~{fragments/topbarCoordinador :: head('Asistencia')}">
        <style>
            #gmaps-markers {
                height: 300px;
                width: 100%;
            }
            .btn-disabled {
                background-color: #d3d3d3 !important;
                border-color: #d3d3d3 !important;
                color: #6c757d !important;
                cursor: not-allowed !important;
            }
        </style>
    </head>
    <body data-sidebar="dark" class="vertical-collpsed">
        <!-- <body data-layout="horizontal" data-topbar="dark"> -->
        <!-- Begin page -->
        <div id="layout-wrapper">
            <div th:replace="fragments/topbarCoordinador :: topbar('Asistencia')"></div>
            <!-- ========== Left Sidebar Start ========== -->
            <div th:replace="fragments/sidebarCoordinador :: sidebar('asistencia')"></div>
            <!-- Left Sidebar End -->



            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="main-content">

                <div class="page-content">
                    <div class="container-fluid">
                        <div class="row mb-4" style="display: flex; align-items: stretch;">
                            <div class="col-lg-5 d-flex">
                                <div class="card mb-0 flex-grow-1">
                                    <div class="card-body mb-3">

                                        <h4 class="card-title mb-4 fw-semibold">Registro de asistencia</h4>

                                        <div class="text-center mb-4">
                                            <div class="display-4 mb-2" id="hora-actual"></div>
                                            <div class="h4 text-muted" id="fecha-actual"></div>
                                        </div>

                                        <script>
                                            function actualizarReloj() {
                                                const ahora = new Date();

                                                // Formatear la hora (HH:MM:SS a.m./p.m.)
                                                const opcionesHora = {
                                                    hour: '2-digit',
                                                    minute: '2-digit',
                                                    second: '2-digit',
                                                    hour12: true
                                                };
                                                const horaFormateada = ahora.toLocaleTimeString('es-PE', opcionesHora);

                                                // Formatear la fecha (ej: "Jueves 03 de Abril del 2025")
                                                const opcionesFecha = {
                                                    weekday: 'long',
                                                    day: '2-digit',
                                                    month: 'long',
                                                    year: 'numeric'
                                                };
                                                const fechaFormateada = ahora.toLocaleDateString('es-PE', opcionesFecha);

                                                // Actualizar el DOM
                                                document.getElementById('hora-actual').textContent = horaFormateada;
                                                document.getElementById('fecha-actual').textContent = fechaFormateada;
                                            }

                                            // Actualizar inmediatamente y luego cada segundo
                                            actualizarReloj();
                                            setInterval(actualizarReloj, 1000);
                                        </script>

                                        <div class="mb-4 text-center">
                                            <div>
                                                <button type="submit" class="btn btn-primary waves-effect waves-light me-1">
                                                    Registrar entrada
                                                </button>
                                                <button type="submit" class="btn btn-primary waves-effect waves-light me-1">
                                                    Registrar salida
                                                </button>
                                            </div>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table mb-0">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>Hora de entrada</th>
                                                        <th>Hora de salida</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr th:if="${asistenciaActiva != null}">
                                                        <td th:text="${asistenciaActiva.registroEntrada != null} ? ${#temporals.format(asistenciaActiva.registroEntrada, 'h:mm a')} : '--'"></td>
                                                        <td th:text="${asistenciaActiva.registroSalida != null} ? ${#temporals.format(asistenciaActiva.registroSalida, 'h:mm a')} : '--'"></td>
                                                    </tr>
                                                    <tr th:if="${asistenciaActiva == null}">
                                                        <td>--</td>
                                                        <td>--</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-7 d-flex">
                                <div class="card mb-0 flex-grow-1">
                                    <div class="card-body">

                                        <h4 class="card-title mb-4 fw-semibold">Historial de asistencia</h4>

                                        <div class="table-responsive">
                                            <table class="table table-centered datatable dt-responsive nowrap" data-bs-page-length="5" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                <thead>
                                                    <tr>
                                                        <th>Fecha</th>
                                                        <th>Establecimiento</th>
                                                        <th>Hora de entrada</th>
                                                        <th>Hora de salida</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="asistencia : ${asistencias}">
                                                        <td th:text="${#temporals.format(asistencia.horarioEntrada, 'dd/MM/yyyy')}"></td>
                                                        <td th:text="${asistencia.espacioDeportivo.establecimientoDeportivo.establecimientoDeportivoNombre}"></td>
                                                        <td th:text="${asistencia.registroEntrada != null} ? ${#temporals.format(asistencia.registroEntrada, 'h:mm a')} : '--'"></td>
                                                        <td th:text="${asistencia.registroSalida != null} ? ${#temporals.format(asistencia.registroSalida, 'h:mm a')} : '--'"></td>
                                                    </tr>
                                                    <tr th:if="${asistencias.isEmpty()}">
                                                        <td colspan="4" class="text-center">No hay asistencias para mostrar</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end row -->

                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">

                                        <div class="row">
                                            <div class="col-md-6">
                                                <h4 class="card-title mb-4 fw-semibold">Asignación actual</h4>
                                                <div class="mb-3">
                                                    <label class="form-label">Horario</label>
                                                    <input type="text" class="form-control" th:value="${horario}" readonly disabled>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Establecimiento</label>
                                                    <input type="text" class="form-control" th:value="${establecimiento}" readonly disabled>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Servicio deportivo</label>
                                                    <input type="text" class="form-control" th:value="${servicioDeportivo}" readonly disabled>
                                                </div>
                                                <a th:href="${asistenciaActiva != null} ? @{/coordinador/observacionNewForm(asistenciaId=${asistenciaActiva.asistenciaId})} : @{/coordinador/observacionNewForm}"
                                                   class="btn btn-primary waves-effect waves-light me-1">
                                                    Registrar observación
                                                </a>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card-body" style="padding-top: 0; padding-bottom: 0">
                                                    <h4 class="card-title mb-4">Ubicación del establecimiento</h4>
                                                    <div id="gmaps-markers" class="gmaps"></div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end row -->

                    </div> <!-- container-fluid -->
                </div>
                <!-- End Page-content -->

                <footer th:replace="fragments/topbarCoordinador :: footer"></footer>

            </div>
            <!-- ============================================================== -->
            <!-- End main content -->
            <!-- ============================================================== -->



        </div>
        <!-- END layout-wrapper -->

        <div class="sidebar-overlay"></div>

        <div th:replace="fragments/topbarCoordinador :: scripts"></div>
        <script th:src="@{/assets/js/pages/asistencia.init.js}"></script>
        <!-- google maps api -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAKJtg2Z14pcYE9UrOGXtN7mTA5HjNsP-o&libraries=places"></script>

        <!-- Gmaps file -->
        <script th:src="@{/assets/libs/gmaps/gmaps.min.js}"></script>
        <!--<script th:src="@{/assets/js/pages/gmaps.init.js}"></script>-->
        <!-- Script para inicializar el mapa -->
        <script th:inline="javascript">
            document.addEventListener('DOMContentLoaded', function () {
                try {
                    var geolocalizacion = /*[[${geolocalizacion}]]*/ null;
                    console.log("Geolocalización recibida:", geolocalizacion); // Depuración
                    var map = new GMaps({
                        div: '#gmaps-markers',
                        lat: -12.043333, // Coordenadas por defecto (Lima, Perú)
                        lng: -77.028333,
                        zoom: 15
                    });

                    if (geolocalizacion) {
                        var coords = geolocalizacion.split(',');
                        if (coords.length === 2) {
                            var lat = parseFloat(coords[0].trim());
                            var lng = parseFloat(coords[1].trim());
                            if (!isNaN(lat) && !isNaN(lng)) {
                                map.setCenter(lat, lng);
                                map.addMarker({
                                    lat: lat,
                                    lng: lng,
                                    title: 'Ubicación del Establecimiento',
                                    click: function(e) {
                                        console.log(e);
                                        alert('You clicked in this marker');
                                    }
                                });
                            } else {
                                console.error("Coordenadas inválidas:", geolocalizacion);
                            }
                        } else {
                            console.error("Formato de geolocalización incorrecto:", geolocalizacion);
                        }
                    } else {
                        console.warn("No se proporcionó geolocalización, usando ubicación por defecto.");
                        map.addMarker({
                            lat: -12.043333,
                            lng: -77.028333,
                            title: 'Ubicación por defecto',
                            click: function(e) {
                                console.log(e);
                                alert('You clicked in this marker');
                            }
                        });
                    }
                } catch (e) {
                    console.error("Error al inicializar el mapa:", e);
                }
            });
        </script>

        <script th:src="@{/superadmin/assets/js/app.js}"></script>
    </body>
    <!-- Mirrored from themesdesign.in/nazox/layouts/calendar.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 30 Aug 2024 19:31:20 GMT -->
</html>
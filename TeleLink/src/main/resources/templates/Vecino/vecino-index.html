<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{Vecino/fragments/topbarVecino.html :: head(title='Inicio')}"></head>
<!--------------------------------------------------------------------------------------------------------------------------------------------->
<body data-sidebar="dark" class="vertical-collpsed">
<!-- Begin page -->
<div id="layout-wrapper">

    <div th:replace="~{Vecino/fragments/topbarVecino :: topbar('Inicio')}"></div>
    <div th:replace="~{Vecino/fragments/sidebarVecino :: sidebar('inicio')}"></div>

    <!--------------------------------------------------------------------------------------------------------------------------------------------->
    <div class="main-content">

        <div class="page-content">
            <div class="container-fluid">

                <!-- start page title -->
                <!------------------------------------------------------------------------------------------------------------------------------------->
                <div class="container-xxl flex-grow-1 container-p-y">
                    <style>
                        #carouselSanMiguel .carousel-item img {
                            height: 280px;
                            object-fit: cover;
                            width: 100%;
                        }
                    </style>

                    <div class="row">
                        <div class="col-12">
                            <div id="carouselSanMiguel" class="carousel slide" data-bs-ride="carousel">

                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <img src="/assets/images/small/sanMi.png" class="d-block img-fluid" alt="Primera imagen">
                                    </div>
                                    <div class="carousel-item">
                                        <img src="/assets/images/small/sanMigue.jpg" class="d-block img-fluid" alt="Segunda imagen">
                                    </div>
                                    <div class="carousel-item">
                                        <img src="/assets/images/small/sanMi_dis.png" class="d-block img-fluid" alt="Tercera imagen">
                                    </div>
                                </div>

                                <button class="carousel-control-prev" type="button" data-bs-target="#carouselSanMiguel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Anterior</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#carouselSanMiguel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Siguiente</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-------------------------------------------------------------------------------------------------------------------------------------->
                <!-- end page title -->

                <!-- üîΩ Introducci√≥n debajo del carrusel -->
                <div class="container mt-5">
                    <div class="text-center">
                        <h2 class="fw-bold">¬°Bienvenido, vecino! üëã</h2>
                        <p class="text-muted">Aqu√≠ podr√°s gestionar tus reservas, consultar tu historial de pagos y realizar nuevas acciones con facilidad.
                            Haz tu reserva en l√≠nea y prep√°rate para vivir la emoci√≥n del deporte en el distrito de San Miguel.</p>
                    </div>
                </div>

                <style>
                    .row.equal-height {
                        display: flex;
                        flex-wrap: wrap;
                    }

                    .row.equal-height > .col-xl-9 {
                        display: flex;
                    }

                    .row.equal-height > .col-xl-3 {
                        display: flex;
                    }

                    .row.equal-height > .col-xl-9 > .card {
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                    }

                    .row.equal-height > .col-xl-3 > .card {
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                    }

                    .row.equal-height > .col-xl-9 > .card > .card-body {
                        flex: 1;
                    }

                    .row.equal-height > .col-xl-3 > .card > .card-body {
                        flex: 1;
                    }
                </style>

                <!-- üîΩ Secci√≥n de canchas populares -->
                <!-- Secci√≥n con fondo blanco detr√°s -->
                <div class="row equal-height">
                    <div class="col-xl-9">
                        <div class="container mt-0 mb-4 me-0 ms-0 p-0">
                            <div class="bg-white rounded shadow-sm p-4">
                                <h4 class="card-title mb-4 fw-semibold">Canchas m√°s populares</h4>

                                <div class="row" th:if="${!#lists.isEmpty(canchasPopulares)}">
                                    <!-- Tarjetas din√°micas -->
                                    <div class="col-md-4" th:each="cancha : ${canchasPopulares}">
                                        <div class="card shadow-sm border-0 h-100">
                                            <img th:src="${cancha.espacioDeportivo.fotoEspacioDeportivoUrl} ?: '/assets/images/small/placeholder.jpg'"
                                                 class="card-img-top" th:alt="${cancha.espacioDeportivo.nombre}"/>
                                            <div class="card-body">
                                <span class="badge bg-light text-primary mb-2 fw-semibold"
                                      th:text="${cancha.espacioDeportivo.servicioDeportivo.servicioDeportivo}">
                                    F√öTBOL
                                </span>
                                                <div class="d-flex align-items-center mb-2">
                                    <span class="fw-bold me-1" th:with="formattedRating=${#numbers.formatDecimal(cancha.promedioCalificacion, 1, 1)}"
                                          th:text="${formattedRating}">4.0</span>
                                                    <span class="text-warning">‚òÖ</span>
                                                    <span class="text-muted ms-1" th:text="'(' + ${cancha.reviewCount} + ')'">(10)</span>
                                                </div>
                                                <h5 class="card-title" th:text="${cancha.espacioDeportivo.nombre}">Cancha de F√∫tbol Municipal</h5>
                                                <p class="card-text text-muted" th:text="${cancha.espacioDeportivo.descripcion} ?: 'Descripci√≥n no disponible'">
                                                    Descripci√≥n no disponible
                                                </p>
                                                <a th:href="@{/usuarios/reservas/{id}(id=${cancha.espacioDeportivo.espacioDeportivoId})}"
                                                   class="btn btn-primary w-100">Ver m√°s</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" th:if="${#lists.isEmpty(canchasPopulares)}">
                                    <div class="col-12">
                                        <p class="text-muted">No hay canchas populares disponibles en este momento.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="card">
                            <div class="card-body p-4">
                                <h4 class="card-title mb-4 fw-semibold">√öltimo aviso</h4>
                                <div data-simplebar>
                                    <div th:if="${ultimoAviso != null}">
                                        <h5 class="font-size-14" th:text="${ultimoAviso.tituloAviso}"></h5>
                                        <p class="text-muted mb-2" th:text="${ultimoAviso.textoAviso}"></p>
                                        <img th:src="${ultimoAviso.fotoAvisoUrl}" alt="Foto del aviso" class="img-fluid mb-2" style="width: 100%; height: 250px; object-fit: cover;" />
                                        <small class="text-muted" th:text="${#temporals.format(ultimoAviso.fechaAviso, 'dd MMM, yyyy HH:mm')}"></small>
                                    </div>
                                    <div th:if="${ultimoAviso == null}">
                                        <p class="text-muted mb-0">No hay avisos disponibles.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-------------------------------------------------------------Chatbot-------------------------------------------------------------------------->
                <!-- Bot√≥n flotante del chatbot -->
                <div id="chat-button" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
                    <button class="btn btn-primary rounded-circle shadow" style="width: 60px; height: 60px;" onclick="toggleChat()">
                        üí¨
                    </button>
                </div>

                <!-- Ventana del chatbot -->
                <div id="chatbox" class="card shadow" style="position: fixed; bottom: 90px; right: 20px; width: 320px; display: none; z-index: 9999;">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <span>Asistente SanMI ü§ñ</span>
                        <button class="btn btn-sm btn-light" onclick="toggleChat()">‚úñ</button>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <!-- Mensaje del bot -->
                        <div class="mb-3">
                            <div class="bg-light rounded p-2 mb-1">
                                <strong>SanMI Bot:</strong><br>
                                ¬°Hola, vecino! üëã<br>
                                ¬øEn qu√© puedo ayudarte hoy?
                            </div>
                        </div>

                        <!-- Opciones simuladas -->
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary btn-sm" onclick="respuestaBot('reservar')">üìù Reservar una cancha</button>
                            <button class="btn btn-outline-primary btn-sm" onclick="respuestaBot('horarios')">üïí Ver horarios disponibles</button>
                            <button class="btn btn-outline-primary btn-sm" onclick="respuestaBot('contacto')">üìû Contactar a la municipalidad</button>
                        </div>

                        <!-- Respuesta din√°mica -->
                        <div id="chat-response" class="mt-3"></div>
                    </div>
                </div>

                <!-- end row -->
            </div>
        </div>
        <!-- End Page-content -->
        <!-------------------------------------------------------------Chatbot-------------------------------------------------------------------------->
    </div>
    <!-- end main content-->

</div>
<!-- END layout-wrapper -->

<div class="sidebar-overlay"></div>

<!-- JAVASCRIPT -->
    <!-- JAVASCRIPT -->
    <script th:src="@{/assets/libs/jquery/jquery.min.js}"></script>
    <script th:src="@{/assets/libs/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/assets/libs/metismenu/metisMenu.min.js}"></script>
    <script th:src="@{/assets/libs/simplebar/simplebar.min.js}"></script>
    <script th:src="@{/assets/libs/node-waves/waves.min.js}"></script>

    <!-- apexcharts -->
    <script th:src="@{/assets/libs/apexcharts/apexcharts.min.js}"></script>

    <!-- jquery.vectormap map -->
    <script th:src="@{/assets/libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.min.js}"></script>
    <script th:src="@{/assets/libs/admin-resources/jquery.vectormap/maps/jquery-jvectormap-us-merc-en.js}"></script>

    <!-- plugin js -->
    <script th:src="@{/assets/libs/moment/min/moment.min.js}"></script>
    <script th:src="@{/assets/libs/jquery-ui-dist/jquery-ui.min.js}"></script>
    <script th:src="@{/assets/libs/@fullcalendar/core/main.min.js}"></script>
    <script th:src="@{/assets/libs/@fullcalendar/bootstrap/main.min.js}"></script>
    <script th:src="@{/assets/libs/@fullcalendar/daygrid/main.min.js}"></script>
    <script th:src="@{/assets/libs/@fullcalendar/timegrid/main.min.js}"></script>
    <script th:src="@{/assets/libs/@fullcalendar/interaction/main.min.js}"></script>

    <!-- Required datatable js -->
    <script th:src="@{/assets/libs/datatables.net/js/jquery.dataTables.min.js}"></script>
    <script th:src="@{/assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js}"></script>

    <!-- Responsive examples -->
    <script th:src="@{/assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js}"></script>
    <script th:src="@{/assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js}"></script>
    <script th:src="@{/assets/js/app.js}"></script>


<!-- Script -->
<script>
    function toggleChat() {
        const chatbox = document.getElementById("chatbox");
        chatbox.style.display = (chatbox.style.display === "none" || chatbox.style.display === "") ? "block" : "none";
    }

    function respuestaBot(opcion) {
        const respuestaDiv = document.getElementById("chat-response");
        let respuesta = '';

        if (opcion === 'reservar') {
            respuesta = '¬°Genial! Puedes ver las canchas disponibles m√°s abajo en la p√°gina o ir a la secci√≥n de reservas.';
        } else if (opcion === 'horarios') {
            respuesta = 'Los horarios disponibles son de 8:00 a.m. a 10:00 p.m. todos los d√≠as. ¬øQuieres ver una cancha espec√≠fica?';
        } else if (opcion === 'contacto') {
            respuesta = 'Puedes comunicarte con la municipalidad al üìû (01) 555-1234 o enviar un correo a contacto@sanmiguel.gob.pe';
        }

        respuestaDiv.innerHTML = `<div class="bg-light rounded p-2"><strong>SanMI Bot:</strong><br>${respuesta}</div>`;
    }

    /*
    function respuestaBot(opcion) {
        fetch("https://cm31mhtld2.execute-api.us-east-1.amazonaws.com/chatbotSanMI", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ pregunta: opcion })
        })
            .then(response => response.json())
            .then(data => {
                document.getElementById("chat-response").innerHTML = `
            <div class="bg-white rounded p-2 mt-2 border">
                <strong>SanMI Bot:</strong><br>${data.respuesta}
            </div>
        `;
            })
            .catch(error => {
                console.error("Error:", error);
                document.getElementById("chat-response").innerHTML = `
            <div class="bg-danger text-white rounded p-2 mt-2">
                Error al conectar con el servidor.
            </div>
        `;
            });
    }
    * */
</script>
</body>
</html>